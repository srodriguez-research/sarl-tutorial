
package eventspaces

import io.sarl.lang.core.Agent
import io.sarl.api.core.Initialize
import io.sarl.api.core.DefaultContextInteractions

import io.sarl.api.core.Behaviors
import io.sarl.api.core.Logging
import io.sarl.api.core.Schedules



event Ping {
  val index : int
}

event Pong {
  val index : int
}

agent PingAgent {
  uses DefaultContextInteractions, Schedules, Logging


  on Pong {
      info("Receiving Pong #" + occurrence.index)
      info("Sending Ping #" + (occurrence.index + 1))
      emit(new Ping( occurrence.index + 1)) [it == occurrence.source]
    }

    on Initialize {
      info("Waiting for Pong Agent")
      val taskVar = task("waiting_for_partner")

      taskVar.every(1000) [
        if (defaultSpace.numberOfStrongParticipants > 1) {
          info("Pong Agent detected.")
          info("Sending Ping #0")
          emit (new Ping(0))
          taskVar.cancel
        }
      ]
    }
}
